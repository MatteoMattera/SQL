-- creazione database
CREATE DATABASE GESTIONENEGOZIODB;

-- utiizzo database creato
USE GESTIONENEGOZIODB ;

-- creazione tabella prodotto PK ID_PRODOTTO
CREATE TABLE PRODOTTO (
ID_PRODOTTO INT NOT NULL AUTO_INCREMENT,
NOME_PRODOTTO VARCHAR (100),
PREZZO DECIMAL (10,2),
PRIMARY KEY (ID_PRODOTTO));


-- creazione tabella clienti PK ID_CLIENTE

CREATE TABLE CLIENTE (
ID_CLIENTE INT NOT NULL AUTO_INCREMENT,
NOME VARCHAR (50),
EMAIL VARCHAR (100),
PRIMARY KEY ( ID_CLIENTE)); 

-- creazione tabella ordini

CREATE TABLE ORDINE (
ID_ORDINE INT NOT NULL AUTO_INCREMENT,
ID_PRODOTTO INT,
ID_CLIENTE INT,
QUANTITA INT,
PRIMARY KEY (ID_ORDINE),
FOREIGN KEY (ID_PRODOTTO) REFERENCES PRODOTTO(ID_PRODOTTO),
FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(ID_CLIENTE));

-- creazione tabella dettaglio_ordine PK ID_PRODOTTO ID_CLIENTE ID_ORDINE.
CREATE TABLE DETTAGLIO_ORDINE (
ID_PRODOTTO INT,
ID_CLIENTE INT,
ID_ORDINE INT,
PREZZO_TOTALE DECIMAL(10, 2),
PRIMARY KEY (ID_PRODOTTO, ID_CLIENTE, ID_ORDINE),
FOREIGN KEY (ID_PRODOTTO) REFERENCES PRODOTTO(ID_PRODOTTO),
FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(ID_CLIENTE),
FOREIGN KEY (ID_ORDINE) REFERENCES ORDINE(ID_ORDINE));

INSERT INTO PRODOTTO (ID_PRODOTTO, NOME_PRODOTTO, PREZZO) VALUES
    (1, 'Tablet', 300.00),
    (2, 'Mouse', 20.00),
    (3, 'Tastiera', 25.00),
    (4, 'Monitor', 180.00),
    (5, 'HHD', 90.00),
    (6, 'SSD', 200.00),
    (7, 'RAM', 100.00),
    (8, 'Router', 80.00),
    (9, 'Webcam', 45.00),
    (10, 'GPU', 1250.00),
    (11, 'Trackpad', 500.00),
    (12, 'Techmagazine', 5.00);

INSERT INTO CLIENTE (ID_CLIENTE, NOME, EMAIL) VALUES
    (1, 'Antonio', NULL),
    (2, 'Battista', 'battista@mailmail.it'),
    (3, 'Maria', 'maria@posta.it'),
    (4, 'Franca', 'franca@lettere.it'),
    (5, 'Ettore', NULL),
    (6, 'Arianna', 'arianna@posta.it'),
    (7, 'Piero', 'piero@lavoro.it');
    
INSERT INTO ORDINE (ID_ORDINE, ID_PRODOTTO,ID_CLIENTE, QUANTITA) VALUES
(1, 2, 1, 10),
(2, 6, 2, 2),
(3, 4, 3, 5),
(4, 9, 1, 1),
(5, 11, 6, 4),
(6, 10, 2, 2),
(7, 3, 3, 3),
(8, 1, 4, 1),
(9, 2, 5, 3),
(10, 1, 6, 2),
(11, 2, 7, 1);

-- controllo inserimento dati nelle tabelle
SELECT * FROM PRODOTTO;
SELECT * FROM ORDINE;
SELECT * FROM CLIENTE;

-- CREAZIONE PREZZO_TOTALE come campo calcolato e inserimento dati nella tabella DETTAGLIO_ORDINE

INSERT INTO DETTAGLIO_ORDINE (ID_PRODOTTO, ID_CLIENTE, ID_ORDINE, PREZZO_TOTALE) 
	SELECT
			ORDINE.ID_PRODOTTO,
			ORDINE.ID_CLIENTE,
			ORDINE.ID_ORDINE,
			(ORDINE.QUANTITA * PRODOTTO.PREZZO) AS PREZZO_TOTALE
	FROM ORDINE
    JOIN PRODOTTO ON ORDINE.ID_PRODOTTO = PRODOTTO.ID_PRODOTTO;

-- VISUALIZZAZIONE TABELLA DETTAGLIO_ORDINE

SELECT * FROM DETTAGLIO_ORDINE;

